<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>814 Rolodex</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .impact { font-family: Impact, 'Arial Black', sans-serif; }
  </style>
</head>
<body>
  <div id="app"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <script>
    // =====================================================
    // ğŸ”¥ FIREBASE CONFIG - REPLACE THESE VALUES
    // =====================================================
    const firebaseConfig = {
      apiKey: "AIzaSyCnflJL4n13wCXb2JAndo6nqWZZGmkBtys",
      authDomain: "rolodex-e3c5f.firebaseapp.com",
      projectId: "rolodex-e3c5f",
      storageBucket: "rolodex-e3c5f.firebasestorage.app",
      messagingSenderId: "1084194538337",
      appId: "1:1084194538337:web:ae6d92c227ecaa54c53b20"
    };
    // =====================================================

    // App state
    let db = null;
    let contacts = [];
    let activeCategory = 'All';
    let searchQuery = '';
    let expandedId = null;
    let editingContact = null;
    let useLocalStorage = false;

    const categories = ['All', 'Neighbor', 'Friend', 'Coworker', 'Family', 'Other'];
    const categoryEmojis = { Neighbor: 'ğŸ ', Friend: 'ğŸ¤', Coworker: 'ğŸ’¼', Family: 'â¤ï¸', Other: 'ğŸ“Œ' };

    // Initialize app
    function init() {
      if (firebaseConfig.apiKey !== "PASTE_YOUR_API_KEY_HERE") {
        try {
          firebase.initializeApp(firebaseConfig);
          db = firebase.firestore();
          loadFromFirebase();
        } catch (e) {
          console.error("Firebase init failed:", e);
          fallbackToLocal();
        }
      } else {
        fallbackToLocal();
      }
    }

    function fallbackToLocal() {
      useLocalStorage = true;
      const saved = localStorage.getItem('814-rolodex-contacts');
      if (saved) contacts = JSON.parse(saved);
      render();
    }

    function loadFromFirebase() {
      db.collection('contacts').orderBy('name').onSnapshot(snapshot => {
        contacts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        render();
      }, error => {
        console.error("Firestore error:", error);
        fallbackToLocal();
      });
    }

    function saveLocal() {
      if (useLocalStorage) {
        localStorage.setItem('814-rolodex-contacts', JSON.stringify(contacts));
      }
    }

    // Category colors
    function getCategoryColor(cat) {
      const colors = {
        Neighbor: 'background: #d1fae5; color: #065f46;',
        Friend: 'background: #ede9fe; color: #5b21b6;',
        Coworker: 'background: #cffafe; color: #155e75;',
        Family: 'background: #fee2e2; color: #991b1b;',
        Other: 'background: #f3f4f6; color: #374151;'
      };
      return colors[cat] || colors.Other;
    }

    function formatBirthday(bday) {
      if (!bday) return '';
      const date = new Date(bday + 'T00:00:00');
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Filter contacts
    function getFilteredContacts() {
      return contacts.filter(c => {
        const matchesCat = activeCategory === 'All' || c.category === activeCategory;
        const q = searchQuery.toLowerCase();
        const matchesSearch = !q ||
          (c.name || '').toLowerCase().includes(q) ||
          (c.location || '').toLowerCase().includes(q) ||
          (c.partner || '').toLowerCase().includes(q) ||
          (c.kids || '').toLowerCase().includes(q) ||
          (c.pets || '').toLowerCase().includes(q) ||
          (c.work || '').toLowerCase().includes(q) ||
          (c.hobbies || '').toLowerCase().includes(q) ||
          (c.notes || '').toLowerCase().includes(q);
        return matchesCat && matchesSearch;
      });
    }

    // Event handlers
    function setCategory(cat) {
      activeCategory = cat;
      render();
    }

    function setSearch(val) {
      searchQuery = val;
      render();
    }

    function toggleExpand(id) {
      expandedId = expandedId === id ? null : id;
      render();
    }

    function jumpToContact(id) {
      expandedId = id;
      render();
      // Scroll to the card after render
      setTimeout(() => {
        const card = document.querySelector(`[data-contact-id="${id}"]`);
        if (card) card.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 50);
    }

    function openModal(contact = null) {
      editingContact = contact || {
        name: '', category: 'Neighbor', location: '', phone: '', birthday: '',
        work: '', hobbies: '', partner: '', kids: '', kidsBirthdays: '', pets: '', notes: '', linkedTo: []
      };
      if (!editingContact.linkedTo) editingContact.linkedTo = [];
      render();
    }

    function closeModal() {
      editingContact = null;
      render();
    }

    async function saveContact(e) {
      e.preventDefault();
      const form = e.target;
      
      // Get selected linked contacts
      const linkedCheckboxes = form.querySelectorAll('input[name="linkedTo"]:checked');
      const linkedTo = Array.from(linkedCheckboxes).map(cb => cb.value);
      
      const data = {
        name: form.name.value.trim(),
        category: form.category.value,
        location: form.location.value.trim(),
        phone: form.phone.value.trim(),
        birthday: form.birthday.value,
        work: form.work.value.trim(),
        hobbies: form.hobbies.value.trim(),
        partner: form.partner.value.trim(),
        kids: form.kids.value.trim(),
        kidsBirthdays: form.kidsBirthdays.value.trim(),
        pets: form.pets.value.trim(),
        notes: form.notes.value.trim(),
        linkedTo: linkedTo
      };

      if (!data.name) return;

      if (useLocalStorage) {
        if (editingContact.id) {
          contacts = contacts.map(c => c.id === editingContact.id ? { ...data, id: editingContact.id } : c);
        } else {
          contacts.push({ ...data, id: Date.now().toString() });
        }
        saveLocal();
      } else {
        try {
          if (editingContact.id) {
            await db.collection('contacts').doc(editingContact.id).update(data);
          } else {
            await db.collection('contacts').add(data);
          }
        } catch (e) {
          alert('Failed to save. Please try again.');
          return;
        }
      }
      closeModal();
    }

    async function deleteContact(id) {
      if (!confirm('Delete this card?')) return;
      if (useLocalStorage) {
        contacts = contacts.filter(c => c.id !== id);
        saveLocal();
        expandedId = null;
        render();
      } else {
        try {
          await db.collection('contacts').doc(id).delete();
          expandedId = null;
        } catch (e) {
          alert('Failed to delete.');
        }
      }
    }

    // Render the app
    function render() {
      const filtered = getFilteredContacts();
      const app = document.getElementById('app');

      app.innerHTML = `
        <div style="min-height: 100vh; background: linear-gradient(180deg, #0077b6 0%, #00b4d8 30%, #90e0ef 60%, #f4e8c1 90%); position: relative; overflow-x: hidden;">
          
          <!-- Header -->
          <div style="position: sticky; top: 0; z-index: 50; background: linear-gradient(135deg, #9b5de5, #ff85a1, #ff6b35); border-bottom: 4px solid #ffd166; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <div style="padding: 1rem; text-align: center;">
              <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 4px;">
                <div class="impact" style="font-size: 2.25rem; color: white; padding: 4px 12px; border-radius: 8px; background: linear-gradient(180deg, #ffd166 0%, #ff6b35 100%); text-shadow: 2px 2px 0 #0077b6; transform: rotate(-2deg); border: 3px solid white; letter-spacing: 2px;">814</div>
                <h1 class="impact" style="font-size: 1.875rem; color: white; text-shadow: 3px 3px 0 #0077b6, -1px -1px 0 #0077b6, 1px -1px 0 #0077b6, -1px 1px 0 #0077b6; transform: rotate(1deg); letter-spacing: 3px;">ROLODEX</h1>
              </div>
              <p class="impact" style="font-size: 1rem; color: #ffd166; text-shadow: 1px 1px 0 #0077b6; letter-spacing: 2px;">Remember more. Awkward less.</p>
            </div>
            <div style="display: flex; justify-content: center; margin-bottom: -4px;">
              <div style="display: flex;">
                ${['A-F', 'G-L', 'M-R', 'S-Z'].map((tab, i) => `
                  <div style="padding: 4px 16px; font-size: 12px; font-weight: bold; border-radius: 8px 8px 0 0; margin: 0 2px; background: ${i === 0 ? '#f4e8c1' : '#e0d4b0'}; color: #666; transform: translateY(4px); border: 2px solid #ccc; border-bottom: none;">${tab}</div>
                `).join('')}
              </div>
            </div>
          </div>

          <!-- Main -->
          <div style="max-width: 672px; margin: 0 auto; padding: 1rem; padding-bottom: 8rem; position: relative; z-index: 10;">
            
            <!-- Controls -->
            <div style="background: linear-gradient(180deg, #fffef9 0%, #f4e8c1 100%); border-radius: 1rem; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 8px 30px rgba(0,0,0,0.15); border: 3px solid #ffd166; position: relative;">
              <div style="position: absolute; top: 12px; left: 50%; transform: translateX(-50%); display: flex; gap: 64px;">
                <div style="width: 16px; height: 16px; border-radius: 50%; background: #e5e5e5; border: 2px solid #ccc;"></div>
                <div style="width: 16px; height: 16px; border-radius: 50%; background: #e5e5e5; border: 2px solid #ccc;"></div>
              </div>
              <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 16px;">
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                  <input type="text" placeholder="ğŸ” Search names, kids, pets, work..." value="${escapeHtml(searchQuery)}" oninput="setSearch(this.value)" style="flex: 1; min-width: 200px; padding: 12px 16px; border-radius: 50px; border: 3px solid #00b4d8; font-size: 16px; outline: none; background: white;">
                  <button onclick="openModal()" style="padding: 12px 24px; border-radius: 50px; background: linear-gradient(135deg, #ff6b35, #ff85a1); color: white; font-weight: 600; font-size: 16px; border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(255,107,53,0.4);">+ Add Person</button>
                </div>
                <div style="display: flex; gap: 8px; overflow-x: auto; padding-bottom: 8px;">
                  ${categories.map(cat => `
                    <button onclick="setCategory('${cat}')" style="padding: 8px 16px; border-radius: 50px; font-weight: bold; font-size: 14px; white-space: nowrap; border: 2px solid #00b4d8; cursor: pointer; ${activeCategory === cat ? 'background: linear-gradient(135deg, #00b4d8, #00f5d4); color: white;' : 'background: white; color: #333;'}">
                      ${cat !== 'All' ? categoryEmojis[cat] + ' ' : ''}${cat}${cat !== 'All' ? ` (${contacts.filter(c => c.category === cat).length})` : ''}
                    </button>
                  `).join('')}
                </div>
              </div>
            </div>

            <!-- Contact List -->
            <div style="display: flex; flex-direction: column; gap: 16px;">
              ${filtered.length === 0 ? `
                <div style="text-align: center; padding: 48px 0;">
                  <div style="font-size: 64px; margin-bottom: 16px;">${contacts.length === 0 ? 'ğŸ‘‹' : 'ğŸ”'}</div>
                  <div style="display: inline-block; background: rgba(255,255,255,0.9); border-radius: 16px; padding: 16px 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="font-size: 24px; font-weight: bold; margin-bottom: 8px; color: #1f2937;">${contacts.length === 0 ? 'No cards yet!' : 'No matches found'}</h3>
                    <p style="color: #4b5563;">${contacts.length === 0 ? 'Tap "+ Add Person" to start your rolodex' : 'Try a different search'}</p>
                  </div>
                </div>
              ` : filtered.map(contact => `
                <div data-contact-id="${contact.id}" style="border-radius: 16px; overflow: hidden; box-shadow: 0 8px 30px rgba(0,0,0,0.15); background: linear-gradient(180deg, #fffef9 0%, #f4e8c1 100%); border: 2px solid #ddd; position: relative;">
                  <div style="height: 6px; background: linear-gradient(90deg, #9b5de5, #ff85a1, #ff6b35, #ffd166, #00f5d4);"></div>
                  <div style="position: absolute; top: 16px; left: 50%; transform: translateX(-50%); display: flex; gap: 96px;">
                    <div style="width: 12px; height: 12px; border-radius: 50%; background: #e5e5e5; border: 1px solid #ccc;"></div>
                    <div style="width: 12px; height: 12px; border-radius: 50%; background: #e5e5e5; border: 1px solid #ccc;"></div>
                  </div>
                  <div onclick="toggleExpand('${contact.id}')" style="padding: 16px; padding-top: 24px; cursor: pointer; position: relative;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px; flex-wrap: wrap;">
                      <h3 class="impact" style="font-size: 20px; color: #1a1a2e; letter-spacing: 0.5px;">${escapeHtml(contact.name)}</h3>
                      <span style="padding: 4px 12px; border-radius: 50px; font-size: 12px; font-weight: bold; text-transform: uppercase; ${getCategoryColor(contact.category)}">${contact.category}</span>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 12px; font-size: 14px; color: #666;">
                      ${contact.location ? `<span>ğŸ“ ${escapeHtml(contact.location)}</span>` : ''}
                      ${contact.partner ? `<span>ğŸ’‘ ${escapeHtml(contact.partner)}</span>` : ''}
                      ${contact.kids ? `<span>ğŸ‘¶ ${escapeHtml(contact.kids)}</span>` : ''}
                      ${contact.pets ? `<span>ğŸ¾ ${escapeHtml(contact.pets)}</span>` : ''}
                      ${contact.work ? `<span>ğŸ’¼ ${escapeHtml(contact.work)}</span>` : ''}
                    </div>
                    <span style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%) ${expandedId === contact.id ? 'rotate(180deg)' : ''}; font-size: 24px; color: #9ca3af; transition: transform 0.3s;">âŒ„</span>
                  </div>
                  ${expandedId === contact.id ? `
                    <div style="padding: 16px; background: rgba(255,255,255,0.6); border-top: 2px dashed #00b4d8;">
                      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; font-size: 14px;">
                        ${contact.phone ? `<div><span style="font-weight: bold; color: #6b7280;">ğŸ“± Phone</span><p style="color: #1f2937;">${escapeHtml(contact.phone)}</p></div>` : ''}
                        ${contact.birthday ? `<div><span style="font-weight: bold; color: #6b7280;">ğŸ‚ Birthday</span><p style="color: #1f2937;">${formatBirthday(contact.birthday)}</p></div>` : ''}
                        ${contact.work ? `<div><span style="font-weight: bold; color: #6b7280;">ğŸ’¼ Work</span><p style="color: #1f2937;">${escapeHtml(contact.work)}</p></div>` : ''}
                        ${contact.hobbies ? `<div><span style="font-weight: bold; color: #6b7280;">âš½ Hobbies</span><p style="color: #1f2937;">${escapeHtml(contact.hobbies)}</p></div>` : ''}
                        ${contact.partner ? `<div><span style="font-weight: bold; color: #6b7280;">ğŸ’‘ Partner</span><p style="color: #1f2937;">${escapeHtml(contact.partner)}</p></div>` : ''}
                        ${contact.location ? `<div><span style="font-weight: bold; color: #6b7280;">ğŸ“ Location</span><p style="color: #1f2937;">${escapeHtml(contact.location)}</p></div>` : ''}
                        ${contact.kids ? `<div><span style="font-weight: bold; color: #6b7280;">ğŸ‘¶ Kids</span><p style="color: #1f2937;">${escapeHtml(contact.kids)}</p></div>` : ''}
                        ${contact.kidsBirthdays ? `<div><span style="font-weight: bold; color: #6b7280;">ğŸˆ Kids' Birthdays</span><p style="color: #1f2937;">${escapeHtml(contact.kidsBirthdays)}</p></div>` : ''}
                        ${contact.pets ? `<div><span style="font-weight: bold; color: #6b7280;">ğŸ¾ Pets</span><p style="color: #1f2937;">${escapeHtml(contact.pets)}</p></div>` : ''}
                      </div>
                      ${(contact.linkedTo && contact.linkedTo.length > 0) ? `
                        <div style="margin-bottom: 16px;">
                          <div style="font-size: 12px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; color: #0077b6; margin-bottom: 8px;">ğŸ”— Linked To</div>
                          <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${contact.linkedTo.map(linkedId => {
                              const linkedContact = contacts.find(c => c.id === linkedId);
                              if (!linkedContact) return '';
                              return `<button onclick="event.stopPropagation(); jumpToContact('${linkedId}')" style="padding: 6px 14px; border-radius: 50px; background: linear-gradient(135deg, #9b5de5, #ff85a1); color: white; font-weight: bold; font-size: 13px; border: none; cursor: pointer; box-shadow: 0 2px 8px rgba(155,93,229,0.3);">${escapeHtml(linkedContact.name)}</button>`;
                            }).join('')}
                          </div>
                        </div>
                      ` : ''}
                      ${contact.notes ? `
                        <div style="margin-bottom: 16px;">
                          <div style="font-size: 12px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; color: #0077b6; margin-bottom: 4px;">ğŸ“ Notes</div>
                          <p style="color: #374151; white-space: pre-wrap;">${escapeHtml(contact.notes)}</p>
                        </div>
                      ` : ''}
                      <div style="display: flex; gap: 12px;">
                        <button onclick="event.stopPropagation(); openModal(contacts.find(c => c.id === '${contact.id}'))" style="flex: 1; padding: 12px; border-radius: 12px; font-weight: bold; color: white; background: #00b4d8; border: none; cursor: pointer;">âœï¸ Edit</button>
                        <button onclick="event.stopPropagation(); deleteContact('${contact.id}')" style="padding: 12px 24px; border-radius: 12px; font-weight: bold; color: #c62828; background: #ffebee; border: none; cursor: pointer;">ğŸ—‘ï¸ Delete</button>
                      </div>
                    </div>
                  ` : ''}
                </div>
              `).join('')}
            </div>

            ${contacts.length > 0 ? `
              <div style="text-align: center; color: white; font-size: 14px; padding: 16px; text-shadow: 1px 1px 0 #0077b6;">
                ${filtered.length} of ${contacts.length} cards
              </div>
            ` : ''}
          </div>

          <!-- Waves -->
          <div style="position: fixed; bottom: 0; left: 0; right: 0; height: 112px; pointer-events: none; z-index: 20;">
            <svg style="position: absolute; bottom: 0; width: 100%; height: 100%;" viewBox="0 0 1440 120" preserveAspectRatio="none">
              <path fill="#0077b6" fill-opacity="0.3" d="M0,64 C120,80 240,96 360,88 C480,80 600,48 720,42 C840,36 960,56 1080,64 C1200,72 1320,68 1380,66 L1440,64 L1440,120 L0,120 Z">
                <animate attributeName="d" dur="12s" repeatCount="indefinite" values="M0,64 C120,80 240,96 360,88 C480,80 600,48 720,42 C840,36 960,56 1080,64 C1200,72 1320,68 1380,66 L1440,64 L1440,120 L0,120 Z;M0,48 C120,56 240,64 360,72 C480,80 600,88 720,80 C840,72 960,48 1080,40 C1200,32 1320,48 1380,56 L1440,64 L1440,120 L0,120 Z;M0,64 C120,80 240,96 360,88 C480,80 600,48 720,42 C840,36 960,56 1080,64 C1200,72 1320,68 1380,66 L1440,64 L1440,120 L0,120 Z"/>
              </path>
              <path fill="#00b4d8" fill-opacity="0.5" d="M0,80 C160,72 320,56 480,60 C640,64 800,88 960,92 C1120,96 1280,80 1360,72 L1440,64 L1440,120 L0,120 Z">
                <animate attributeName="d" dur="8s" repeatCount="indefinite" values="M0,80 C160,72 320,56 480,60 C640,64 800,88 960,92 C1120,96 1280,80 1360,72 L1440,64 L1440,120 L0,120 Z;M0,72 C160,88 320,96 480,88 C640,80 800,56 960,52 C1120,48 1280,64 1360,76 L1440,88 L1440,120 L0,120 Z;M0,80 C160,72 320,56 480,60 C640,64 800,88 960,92 C1120,96 1280,80 1360,72 L1440,64 L1440,120 L0,120 Z"/>
              </path>
              <path fill="#90e0ef" fill-opacity="0.7" d="M0,96 C180,88 360,72 540,76 C720,80 900,96 1080,100 C1260,104 1350,96 1395,92 L1440,88 L1440,120 L0,120 Z">
                <animate attributeName="d" dur="5s" repeatCount="indefinite" values="M0,96 C180,88 360,72 540,76 C720,80 900,96 1080,100 C1260,104 1350,96 1395,92 L1440,88 L1440,120 L0,120 Z;M0,88 C180,96 360,104 540,100 C720,96 900,80 1080,76 C1260,72 1350,84 1395,92 L1440,100 L1440,120 L0,120 Z;M0,96 C180,88 360,72 540,76 C720,80 900,96 1080,100 C1260,104 1350,96 1395,92 L1440,88 L1440,120 L0,120 Z"/>
              </path>
            </svg>
          </div>

          <!-- Modal -->
          ${editingContact ? `
            <div onclick="if(event.target === this) closeModal()" style="position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center; padding: 16px; background: rgba(0,0,0,0.6);">
              <div style="background: linear-gradient(180deg, #fffef9 0%, #f4e8c1 100%); border-radius: 16px; width: 100%; max-width: 448px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); border: 4px solid #ffd166; position: relative;">
                <div style="height: 8px; background: linear-gradient(90deg, #9b5de5, #ff85a1, #ff6b35, #ffd166, #00f5d4);"></div>
                <div style="position: absolute; top: 24px; left: 50%; transform: translateX(-50%); display: flex; gap: 96px;">
                  <div style="width: 16px; height: 16px; border-radius: 50%; background: #e5e5e5; border: 2px solid #ccc;"></div>
                  <div style="width: 16px; height: 16px; border-radius: 50%; background: #e5e5e5; border: 2px solid #ccc;"></div>
                </div>
                <div style="padding: 24px; padding-top: 40px;">
                  <h2 class="impact" style="font-size: 24px; text-align: center; margin-bottom: 24px; color: #0077b6; letter-spacing: 1px;">${editingContact.id ? 'Edit Card' : 'New Card'}</h2>
                  <form onsubmit="saveContact(event)" style="display: flex; flex-direction: column; gap: 16px;">
                    <div>
                      <label style="display: block; font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 4px;">Name *</label>
                      <input name="name" type="text" value="${escapeHtml(editingContact.name)}" placeholder="John Smith" required style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #e5e7eb; font-size: 16px; background: white;">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                      <div>
                        <label style="display: block; font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 4px;">Category</label>
                        <select name="category" style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #e5e7eb; font-size: 16px; background: white;">
                          ${categories.filter(c => c !== 'All').map(cat => `<option value="${cat}" ${editingContact.category === cat ? 'selected' : ''}>${categoryEmojis[cat]} ${cat}</option>`).join('')}
                        </select>
                      </div>
                      <div>
                        <label style="display: block; font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 4px;">ğŸ“ Location</label>
                        <input name="location" type="text" value="${escapeHtml(editingContact.location)}" placeholder="Yellow house on corner" style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #e5e7eb; font-size: 16px; background: white;">
                      </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                      <div>
                        <label style="display: block; font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 4px;">ğŸ“± Phone</label>
                        <input name="phone" type="tel" value="${escapeHtml(editingContact.phone)}" placeholder="(814) 555-1234" style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #e5e7eb; font-size: 16px; background: white;">
                      </div>
                      <div>
                        <label style="display: block; font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 4px;">ğŸ‚ Birthday</label>
                        <input name="birthday" type="date" value="${editingContact.birthday || ''}" style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #e5e7eb; font-size: 16px; background: white;">
                      </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                      <div>
                        <label style="display: block; font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 4px;">ğŸ’¼ Work</label>
                        <input name="work" type="text" value="${escapeHtml(editingContact.work)}" placeholder="Nurse at UPMC" style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #e5e7eb; font-size: 16px; background: white;">
                      </div>
                      <div>
                        <label style="display: block; font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 4px;">âš½ Hobbies</label>
                        <input name="hobbies" type="text" value="${escapeHtml(editingContact.hobbies)}" placeholder="Fishing, Steelers" style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #e5e7eb; font-size: 16px; background: white;">
                      </div>
                    </div>
                    <div>
                      <label style="display: block; font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 4px;">ğŸ’‘ Partner / Spouse</label>
                      <input name="partner" type="text" value="${escapeHtml(editingContact.partner)}" placeholder="Jane" style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #e5e7eb; font-size: 16px; background: white;">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                      <div>
                        <label style="display: block; font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 4px;">ğŸ‘¶ Kids</label>
                        <input name="kids" type="text" value="${escapeHtml(editingContact.kids)}" placeholder="Tommy, Sarah" style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #e5e7eb; font-size: 16px; background: white;">
                      </div>
                      <div>
                        <label style="display: block; font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 4px;">ğŸˆ Kids' Birthdays</label>
                        <input name="kidsBirthdays" type="text" value="${escapeHtml(editingContact.kidsBirthdays)}" placeholder="Tommy 3/15, Sarah 8/22" style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #e5e7eb; font-size: 16px; background: white;">
                      </div>
                    </div>
                    <div>
                      <label style="display: block; font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 4px;">ğŸ¾ Pets</label>
                      <input name="pets" type="text" value="${escapeHtml(editingContact.pets)}" placeholder="Max (golden retriever)" style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #e5e7eb; font-size: 16px; background: white;">
                    </div>
                    <div>
                      <label style="display: block; font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 4px;">ğŸ“ Notes</label>
                      <textarea name="notes" rows="3" placeholder="Anything else to remember..." style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #e5e7eb; font-size: 16px; resize: none; background: white;">${escapeHtml(editingContact.notes)}</textarea>
                    </div>
                    ${contacts.filter(c => c.id !== editingContact.id).length > 0 ? `
                    <div>
                      <label style="display: block; font-size: 14px; font-weight: bold; color: #374151; margin-bottom: 8px;">ğŸ”— Linked To</label>
                      <div style="max-height: 150px; overflow-y: auto; padding: 12px; border-radius: 12px; border: 2px solid #e5e7eb; background: white;">
                        ${contacts.filter(c => c.id !== editingContact.id).map(c => `
                          <label style="display: flex; align-items: center; gap: 8px; padding: 8px; cursor: pointer; border-radius: 8px; margin-bottom: 4px; background: ${(editingContact.linkedTo || []).includes(c.id) ? '#e0f2fe' : 'transparent'};">
                            <input type="checkbox" name="linkedTo" value="${c.id}" ${(editingContact.linkedTo || []).includes(c.id) ? 'checked' : ''} style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="font-size: 15px; color: #1f2937;">${escapeHtml(c.name)}</span>
                            <span style="font-size: 12px; color: #6b7280; margin-left: auto;">${c.category}</span>
                          </label>
                        `).join('')}
                      </div>
                      <p style="font-size: 12px; color: #6b7280; margin-top: 4px;">Select people to link to this card</p>
                    </div>
                    ` : ''}
                    <div style="display: flex; gap: 16px; padding-top: 16px;">
                      <button type="button" onclick="closeModal()" style="flex: 1; padding: 12px; border-radius: 50px; font-weight: bold; color: #4b5563; background: #e5e7eb; border: none; cursor: pointer;">Cancel</button>
                      <button type="submit" class="impact" style="flex: 1; padding: 12px; border-radius: 50px; font-weight: bold; color: white; background: linear-gradient(135deg, #00f5d4, #00b4d8); border: none; cursor: pointer; letter-spacing: 1px; box-shadow: 0 4px 15px rgba(0,245,212,0.4);">Save!</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          ` : ''}
        </div>
      `;
    }

    // Start the app
    init();
  </script>
</body>
</html>
